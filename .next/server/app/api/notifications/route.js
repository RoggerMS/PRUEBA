"use strict";(()=>{var e={};e.id=1996,e.ids=[1996],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},39974:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>x,dynamic:()=>p,runtime:()=>c});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),u=r(45609),d=r(95456),l=r(13538);let p="force-dynamic",c="nodejs";async function m(e){try{let t=await (0,u.getServerSession)(d.Lz);if(!t?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),s="true"===r.get("unread"),a=parseInt(r.get("limit")||"50"),i=parseInt(r.get("offset")||"0"),n=await l._.user.findUnique({where:{email:t.user.email}});if(!n)return o.NextResponse.json({error:"User not found"},{status:404});let p={userId:n.id,...s&&{read:!1}},c=await l._.notification.findMany({where:p,orderBy:{createdAt:"desc"},take:a,skip:i,select:{id:!0,type:!0,title:!0,message:!0,data:!0,read:!0,createdAt:!0}}),m=await l._.notification.count({where:p});return o.NextResponse.json({notifications:c,totalCount:m,hasMore:i+a<m})}catch(e){return o.NextResponse.json({error:"Internal server error"},{status:500})}}async function x(e){try{let t=await (0,u.getServerSession)(d.Lz);if(!t?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{type:r,title:s,message:a,data:i}=await e.json();if(!r||!s||!a)return o.NextResponse.json({error:"Missing required fields: type, title, message"},{status:400});let n=await l._.user.findUnique({where:{email:t.user.email}});if(!n)return o.NextResponse.json({error:"User not found"},{status:404});let p=await l._.notification.create({data:{userId:n.id,type:r,title:s,message:a,data:i||{},read:!1}});return o.NextResponse.json(p,{status:201})}catch(e){return o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/notifications/route",pathname:"/api/notifications",filename:"route",bundlePath:"app/api/notifications/route"},resolvedPagePath:"C:\\Users\\bestr\\OneDrive\\Desktop\\git\\PRUEBA\\app\\api\\notifications\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:g}=f,h="/api/notifications/route";function q(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>o});var s=r(13539),a=r(53797),i=r(13538),n=r(98691);let o={adapter:(0,s.N)(i._),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await d(e.email);return t&&t.password&&await u(e.password,t.password)?{id:t.id,email:t.email,name:t.name,username:t.username,image:t.image}:null}})],session:{strategy:"jwt"},pages:{signIn:"/auth/login",error:"/auth/error"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.username=t.username),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.username=t.username),e)},events:{async signIn({user:e,isNewUser:t}){if(t)try{await i._.user.update({where:{id:e.id},data:{crolars:1e3,level:1,xp:0,streak:0,lastActivity:new Date}}),await i._.notification.create({data:{userId:e.id,type:"SYSTEM",title:"\xa1Bienvenido a CRUNEVO!",message:"Completa tu perfil y comienza a conectar con otros estudiantes. \xa1Recibiste 1000 Crolars de bienvenida!",read:!1}})}catch(e){}else try{await i._.user.update({where:{id:e.id},data:{lastActivity:new Date}})}catch(e){}}},secret:process.env.NEXTAUTH_SECRET};async function u(e,t){return n.ZP.compare(e,t)}async function d(e){try{return await i._.user.findUnique({where:{email:e},select:{id:!0,email:!0,name:!0,username:!0,image:!0,password:!0,emailVerified:!0}})}catch(e){return null}}},13538:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient({log:["query"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,7901,1184,7070],()=>r(39974));module.exports=s})();